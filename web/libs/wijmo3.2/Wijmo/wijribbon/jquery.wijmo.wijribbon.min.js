var __extends=this.__extends||function(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n},wijmo;(function(e){(function(t){"use strict";var n=jQuery,r="wijribbon",i="wijmo-wijribbon",s=i+"-disabled",o=i+"-bigbutton",u=i+"-panel",a=i+"-groups",f=i+"-group",l=f+"-content",c=f+"-label",h=i+"-dropdown",p=i+"-dropdowngroup",d=i+"-abbrev",v=d+"group",m=i+"-text",g=i+"-icon",y=i+"-abbrevicon",b=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype._create=function(){var e=this;window.wijmoApplyWijTouchUtilEvents&&(n=window.wijmoApplyWijTouchUtilEvents(n)),e._ribbonify(),e.element.is(":hidden")&&e.element.wijAddVisibilityObserver&&e.element.wijAddVisibilityObserver(function(){e.updateRibbonSize(),e.options.disabled&&e._setDisabled(!0),e.element.wijRemoveVisibilityObserver&&e.element.wijRemoveVisibilityObserver()},"wijribbon"),e.options.disabled&&e._setDisabled(!0)},t.prototype._setOption=function(e,t){n.wijmo.widget.prototype._setOption.apply(this,arguments),e==="disabled"&&this._setDisabled(t)},t.prototype._setDisabled=function(e){var t=this,r=t.element,i=r.offset(),o=i.top,u=i.left,a=n("body"),f=this.options.wijCSS,l=t.disabledModal;r.data("wijmoWijtabs")&&r.wijtabs("option","disabled",e),r.closest(".wijmo-wijeditor").length!==0&&(o=0,u=0,a=r.parent()),e?(l||(l=n("<div></div>").addClass(f.stateDisabled+" "+s).css({top:o,left:u,"background-color":"lightgray",position:"absolute"}).appendTo(a).bind("click mousedown mouseup mouseover mouseout focus keydown keypress",function(e){return e.stopPropagation(),e.preventDefault(),!1}),t.disabledModal=l),t.disabledModal.width(r.width()).height(r.outerHeight()).show()):t.disabledModal&&t.disabledModal.hide()},t.prototype._ribbonify=function(){var e=this,t=this.options.wijCSS;e.buttons={},e.listUis={},e._getButtonSets(),e._createButtons(),e._createGroup(),e._createSplit(),e._createDropdwon(),e._hideShowedList(),e._createTab(),n("."+t.helperReset+":not(."+a+", ."+t.tabsNav+")",e.element).hover(function(){n(this).addClass(t.stateHover)},function(){n(this).removeClass(t.stateHover)}),n(".ui-button",e.element).bind("mouseenter",function(){n("."+t.buttonText,this).addClass(t.stateHover)}).bind("mouseleave",function(){n("."+t.buttonText,this).removeClass(t.stateHover)}),n("button.ui-button",e.element).bind("mousedown",function(){e._addActiveClassToButtonText(this)}).bind("mouseup",function(){e._addActiveClassToButtonText(this)})},t.prototype._addActiveClassToButtonText=function(e){var t=this.options.wijCSS;e&&(n(e).hasClass(t.stateActive)?n("."+t.buttonText,e).addClass(t.stateActive):n("."+t.buttonText,e).removeClass(t.stateActive))},t.prototype._addActiveClassToLabelButtonText=function(e){var t=this,r,i,s;e&&(i=n(e).attr("for"),r=n("#"+i,t.element),r.is(":checkbox")?t._addActiveClassToButtonText(e):r.is(":radio")&&(s=t.element.find("[name='"+r.attr("name")+"']"),n.each(s,function(){t._updateGroupElementTextState(this)})))},t.prototype._updateGroupElementTextState=function(e){var t,r=this.options.wijCSS;if(!e)return;t=n("[for='"+n(e).attr("id")+"']",n(e).parent()),t&&(t.hasClass(r.stateActive)?t.children("."+r.buttonText).addClass(r.stateActive):t.children("."+r.buttonText).removeClass(r.stateActive))},t.prototype._getButtonSets=function(){var e=this,t;e.groups=[],e.splits=[],e.dropdowns=[],n("span>button, span>:checkbox, span>:radio, div>button, div>:checkbox, div>:radio",e.element).each(function(r,i){return t=n(i).parent(),n(">ul",t).length===0?e.groups.push(t):n(">button",t).length===2?e.splits.push(t):n(">button",t).length===1&&e.dropdowns.push(t),this}),e.groups=e._unique(e.groups),e.splits=e._unique(e.splits)},t.prototype._unique=function(e){var t=n.makeArray(n.map(e,function(e){return e.get(0)}));return n.map(n.unique(t),function(e){return n(e)})},t.prototype._createButtons=function(){var e=this,t=e.element;n(":checkbox",t).each(function(){return e._createButton(n(this),"checkbox"),n(this).bind("change",function(){e._addActiveClassToLabelButtonText(n(this).button("widget")[0])}),this}),n(":radio",t).each(function(){return e._createButton(n(this),"radio"),n(this).bind("change",function(){e._addActiveClassToLabelButtonText(n(this).button("widget")[0])}),this}),n("button",t).each(function(){return e._createButton(n(this),"button"),this})},t.prototype._createButton=function(e,t){var r=this,i=this.options.wijCSS,s=r._buildButtonOption(e,t),o=e.data("commandName"),u;e.button(s),s.text||(t==="button"?e.children("."+i.buttonText).text(o):(u=n("[for='"+e.attr("id")+"']",e.parent()),u&&u.children("."+i.buttonText).text(o))),r._triggerEvent(e)},t.prototype._createGroup=function(){n.each(this.groups,function(e,t){t.buttonset()})},t.prototype._createSplit=function(){var e=this,t=this.options.wijCSS;n.each(e.splits,function(r,s){var o=s.children("ul"),u=s.children("button:eq(0)"),a=u.data("commandName"),f=s.children("button:eq(1)"),l;o.children("li").addClass(t.cornerAll),s.addClass(i+"-"+a),f.button({icons:{primary:t.iconArrowDown},text:!1}).data("list",o).unbind("click").bind("click",function(e){e.stopPropagation(),e.preventDefault()}).bind("mouseup",function(t){o=n(this).data("list"),o.is(":visible")?(e.showList.hide().css("z-index",""),e.showList=null):(o.show().position({my:"left top",at:"left bottom",of:s}).css("z-index",9999),e.showList=o),t.stopPropagation(),t.preventDefault()}),f.children("."+t.buttonText).text("foo"),s.after(o),o.css("position","absolute").addClass(t.helperReset+" "+t.helperClearFix+" "+t.cornerAll+" "+h).hide(),s.buttonset(),l={ui:u,defaultValue:u.button("option","label"),buttons:[],type:"split",trigger:f,list:o},n("button, :checkbox, :radio",o).bind("click",function(t){o.hide().css("z-index",""),e.showList=null,t.preventDefault()}),o.find(">li>button,>li>:radio,>li>:checkbox").each(function(t,r){var i=n(r).data("commandName");i!==""&&e.buttons[i]&&(e.buttons[i].parent=u,e.buttons[i].type="split"),l.buttons.push(n(r))}),a!==""&&(e.listUis[a]=l)})},t.prototype._createDropdwon=function(){var e=this,t=this.options.wijCSS;e.dropdownLabels={},n.each(e.dropdowns,function(r,s){var o=s.children("ul"),u=s.children("button:eq(0)"),a=u.data("commandName"),f;o.children("li").addClass(t.cornerAll),s.addClass(i+"-"+a),u.button({icons:{secondary:t.iconArrowDown}}).unbind("click").bind("click",function(e){e.stopPropagation(),e.preventDefault()}).bind("mouseup",function(t){o.is(":visible")?(e.showList.hide().css("z-index",""),e.showList=null):(e.showList&&(e.showList.hide(),e.showList=null),o.show().position({my:"left top",at:"left bottom",of:u}).css("z-index",9999),e.showList=o,e.isShow=!0),t.stopPropagation(),t.preventDefault()}),f={ui:u,defaultValue:u.button("option","label"),buttons:[],type:"dropdown",list:o},n("button, :checkbox, :radio",o).bind("click",function(r){var i=n(this).data("commandName"),s,a=u.children("."+t.buttonText).width();e.dropdownLabels[i]||(e.dropdownLabels[i]=e._getDropdownLabelSubstr(n(this).button("option","label"),u.children("."+t.buttonText),a)),s=e.dropdownLabels[i],u.button("option","label",s),u.attr("title",n(this).button("option","label")),o.hide().css("z-index",""),e.showList=null,r.preventDefault()}),o.css("position","absolute").addClass(t.helperReset+" "+t.helperClearFix+" "+t.cornerAll+" "+h).hide(),s.buttonset(),o.find(">li>button,>li>:radio,>li>:checkbox").each(function(t,r){var i=n(r).data("commandName");i!==""&&e.buttons[i]&&(e.buttons[i].parent=u,e.buttons[i].type="dropdown"),f.buttons.push(n(r))}),a!==""&&(e.listUis[a]=f)})},t.prototype._createTab=function(){var e=this,t=this.options.wijCSS,r=e.element;return r.addClass(i),e.tabEle=r,n(">ul",r).length>0?(r.wijtabs(),e._createRibbonGroups(),!0):(r.addClass(i+"-simple").addClass(t.stateDefault).addClass(t.helperClearFix),!1)},t.prototype.updateRibbonSize=function(){var e=this,t,r=this.options.wijCSS,s;e.tabEle.children("div").each(function(o,u){var a=n(u),f=a.is(":visible"),l=a.find(">ul>li"),c=[],h;return h=a.width(),f||(a.removeClass(r.wijtabsHide),h=a.width()),l.each(function(e,r){var o=n(r),u=o.find(">div:last"),a=u.attr("displayname")?u.attr("displayname"):n.trim(u.text());return t=o.children("."+p),s=o.children("."+v),t&&(o.addClass(i+"-"+a.toLowerCase()).prepend(t.children()),t.remove(),s&&s.remove()),c.push({width:o.outerWidth(!0),text:a}),this}),e._adjustRibbonGroupIfNeeded(l,c,h),f||a.addClass(r.wijtabsHide),this}),e.options.disabled&&e._setDisabled(!0)},t.prototype._createRibbonGroups=function(){var e=this,t=this.options.wijCSS;e.tabEle.children("div").each(function(r,s){var o=n(s),h=o.is(":visible"),p=o.find(">ul>li"),d=[],v;if(o.data("destroy.tabs")){o.remove();return}return h||o.removeClass(t.wijtabsHide),v=o.width(),o.addClass(u),o.find(">ul").addClass(t.helperReset+" "+t.helperClearFix+" "+t.content+" "+t.cornerAll+" "+a),p.each(function(e,r){var s=n(r),o=s.find(">div:last"),u=t.stateDefault+" "+f,a=o.attr("displayname")?o.attr("displayname"):n.trim(o.text());return o&&(u+=" "+i+"-"+a.toLowerCase()),s.addClass(u),o.addClass(c).bind("click",function(){return!1}),s.wrapInner("<div class = '"+l+"'></div>"),s.children().bind("mouseover",function(){n(this).addClass(t.stateHover)}).bind("mouseout",function(){n(this).removeClass(t.stateHover)}),o.appendTo(s),d.push({width:s.outerWidth(!0),text:a}),this}),e._originalGroupInfo=d,e._adjustRibbonGroupIfNeeded(p,d,v),h||o.addClass(t.wijtabsHide),this})},t.prototype._adjustRibbonGroupIfNeeded=function(e,t,r){var s=this,o=e.length-1,u=0,a=0,f=0,l,c,h;for(;o>=0;o--){f=0;for(u=0;u<o;u++)f+=t[u].width;f+a+t[o].width<=r?(l=n(e[o]).children("."+p),c=n(e[o]).children("."+v),l&&(n(e[o]).addClass(i+"-"+t[o].text.toLowerCase()).prepend(l.children()),l.remove(),c&&c.remove())):(h=t[o],a+=s._createDropDownRibbonGroup(h.text,e[o]))}},t.prototype._createDropDownRibbonGroup=function(e,t){var r=this,s=i+"-"+e.toLowerCase(),o=this.options.wijCSS,u=n(t).removeClass(s),a=u.find(">div:last").text()||e,l;return u.wrapInner("<div class='"+p+" "+f+"'></div>").children().hide().addClass(s).bind("mouseup."+r.widget,function(e){r.showDrpDwnGroup!==null&&(r.showDrpDwnGroup.hide().css("z-index",""),r.showDrpDwnGroup=null)}),l=n("<div class='"+v+"'>"+"<span class='"+d+e.toLowerCase()+" "+g+" "+y+"'></span>"+"<span class='"+m+"'>"+a+"</span>"+"<span class='"+o.icon+" "+o.iconArrowDown+" "+g+"'></span></div>").appendTo(u).unbind(r.widget).bind("mouseover."+r.widget,function(e){n(this).addClass(o.stateHover)}).bind("mouseout."+r.widget,function(e){n(this).removeClass(o.stateHover)}).bind("click."+r.widget,function(e){var t=n(this).siblings("."+p);t.is(":visible")?(t.hide().css("z-index",""),r.showDrpDwnGroup=null):(r.showDrpDwnGroup&&r.showDrpDwnGroup.hide().css("z-index",""),t.show().position({my:"left top",at:"left bottom",of:this}).css("z-index","10000"),r.showDrpDwnGroup=t,e.stopPropagation())}),u.outerWidth(!0)},t.prototype._hideShowedList=function(){var e=this;n(document).bind("mouseup",function(t){var r=t.target;e.showList&&(n(r).is(document)||!n.contains(e.showList.get(0),r))&&(e.showList.hide().css("z-index",""),e.showList=null),e.showDrpDwnGroup&&(n(r).is(document)||!n.contains(e.showDrpDwnGroup.get(0),r))&&(e.showDrpDwnGroup.hide().css("z-index",""),e.showDrpDwnGroup=null)})},t.prototype._buildButtonOption=function(e,t){var r=!0,i=this,s=e.attr("class"),u,a,f,l,c,h,p;if(s&&s!==""&&s!==o)a=s.split(" ")[0],e.removeClass(a),c=n.trim(e.text()),c===""&&(r=!1);else{if(t==="checkbox"||t==="radio"){if(n.trim(e.attr("id"))==="")return;h=n("[for='"+e.attr("id")+"']",e.parent());if(!h.is("label"))return;s=h.attr("class"),s&&s!==""&&s!==o?(a=s.split(" ")[0],h.removeClass(a),c=n.trim(h.text()),c===""&&(r=!1)):u=h.children("span,div")}else t==="button"&&(u=e.children("span,div"));u&&(u.length===1?u.eq(0).attr("class")!==""&&(f=u.eq(0),a=f.attr("class"),r=!1):u.length===2?u.eq(0).attr("class")&&(f=u.eq(0),a=f.attr("class"),f.is("span")?l="left":f.is("div")&&(l="top"),c=u.eq(1).text()):t==="button"&&n.trim(e.text())!==""&&(c=n.trim(e.text())))}return t==="button"?(e.empty(),p=n.trim(e.attr("name")),p!==""&&e.removeAttr("name")):(p=n.trim(h.attr("name")),p!==""&&h.removeAttr("name")),p!==""&&(e.data("commandName",p),i.buttons[p]={button:e}),{label:c,icons:{primary:a},position:l,text:r}},t.prototype._triggerEvent=function(e){var t=this;e.bind("click",function(n){if(t.options.disabled){n.preventDefault(),n.stopPropagation();return}var r=e.data("commandName"),i=t.buttons[r],s={name:undefined,commandName:undefined};i&&i.parent&&(s.name=i.parent.data("commandName")),s.commandName=r,t._trigger("click",n,s),e.is("button")&&(n.preventDefault(),n.stopPropagation())})},t.prototype._getDropdownLabelSubstr=function(e,t,r){var i=this,s=e.length,o=0,u=s,a=Math.floor((o+u)/2),f=n("<span></span>"),l=e.substr(0,a),c;f.appendTo(t.parent()),c=i._calculateWidth(l,f);while(c!==r&&u>o)l=e.substr(0,a+1),c=i._calculateWidth(l,f),c>r?u=a-1:c<r&&(o=a+1),a=Math.floor((o+u)/2);return f.remove(),l},t.prototype._calculateWidth=function(e,t){return t.text(e),t.width()},t.prototype.hideDropdown=function(e){var t=this,n=t.listUis[e];n&&n.list&&n.list.hide()},t.prototype.destroy=function(){this.disabledModal&&this.disabledModal.remove(),n.Widget.prototype.destroy.call(this)},t.prototype.getDropdownList=function(e){var t=this,r=t.listUis[e],i={};return r&&n.each(r.buttons,function(e,t){i[t.data("commandName")]=t.button("option","label")}),i},t.prototype.setButtonDisabled=function(e,t){var r=this.buttons[e],i=this.options.wijCSS,s=!1,o,u;r&&r.button&&(o=r.button,s=o.is("button"),o.button("option","disabled",t),s?e!=="save"&&o.children("."+i.buttonText).text(e):n("[for='"+o.attr("id")+"']",o.parent()).children("."+i.buttonText).text(e),u=this.listUis[e],u&&u.type==="split"&&(u.trigger.button("option","disabled",t),u.trigger.children("."+i.buttonText).text(e)))},t.prototype.setButtonsDisabled=function(e){var t=this;n.each(e,function(e,n){t.setButtonDisabled(e,n)})},t.prototype.setButtonsChecked=function(e){var t=this;n.each(e,function(e,r){n.isPlainObject(r)?t.setButtonChecked(e,r.checked,r.name):t.setButtonChecked(e,r,null)})},t.prototype.setButtonChecked=function(e,t,r){var i=this,s,o=i.buttons[e],u=this.options.wijCSS,a,f,l;o&&o.button?(a=o.button,a.is("button")?t?a.addClass(u.stateActive):a.removeClass(u.stateActive):(a.prop("checked",t),a.button("refresh")),o.parent?o.type==="dropdown"&&t&&(i.dropdownLabels[e]||(i.dropdownLabels[e]=i._getDropdownLabelSubstr(a.button("option","label"),o.parent.children("."+u.buttonText),o.parent.children("."+u.buttonText).width())),l=i.dropdownLabels[e],o.parent.button("option","label",l),o.parent.attr("title",a.button("option","label")),s=n(":radio",o.button.closest("ul")),s&&n.each(s,function(){i._updateGroupElementTextState(this)})):i._addActiveClassToButtonText(a.button("widget"))):r&&(f=i.listUis[r],f&&(f.ui.button("option","label",f.defaultValue),f.buttons&&n.each(f.buttons,function(e,t){t.prop("checked",!1),t.button("refresh"),i._addActiveClassToButtonText(t.button("widget"))})))},t}(e.wijmoWidget);t.wijribbon=b;var w=function(){function e(){this.initSelector=":jqmData(role='wijribbon')",this.wijCSS={wijtabsHide:"wijmo-wijtabs-hide"},this.click=null}return e}();b.prototype.options=n.extend(!0,{},e.wijmoWidget.prototype.options,new w),n.wijmo.registerWidget("wijribbon",b.prototype)})(e.ribbon||(e.ribbon={}));var t=e.ribbon})(wijmo||(wijmo={}));